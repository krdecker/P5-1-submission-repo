function getModel(){return localStorage.model?JSON.parse(localStorage.model):EatsModel}function buildWindowContent(e){var t="http://maps.googleapis.com/maps/api/streetview?size=200x150&location="+e.position.toString(),o='<img class="bgimg" src="'+t+'">',n='"height:100%;width:80%"',i='<div onclick="itchwindow()" style='+n+">"+o+'<br><span style="color:darkgreen">'+e.title+'</span><br><span style="color:red">-CLICK FOR MORE INFO-</span></div>';return i}function buildSlideContent(e){function t(t){var i=t.response.venues[0];$.ajax({url:fourSquareURL+"/v2/venues/"+i.id,dataType:"json",data:"limit=1&"+a+"&query="+e.name+"&client_id="+kr.foursquare.Client_id+"&client_secret="+kr.foursquare.Client_secret+"&v=20160130",async:!0,error:n}).success(function(e){o(e)})}function o(t){var o=t.response.venue;s="FourSquare info: <br><br>"+o.name+"<br>"+o.contact.formattedPhone+"<br>- "+o.location.address+"<br>- "+o.location.city+"<br>- "+o.location.country+"<br>x-street: "+o.location.crossStreet+"<br>Check-ins: "+o.stats.checkinsCount.toString()+"<br>"+o.likes.summary+'<br><br><span style="background-color:#'+o.ratingColor+';color:black;padding:1%">Rating: '+o.rating.toString()+'</span><br><img src="'+o.bestPhoto.prefix+"cap300"+o.bestPhoto.suffix+'">',e.slideContent=s,console.log(e.slideContent)}function n(t,o,n){i="Web call failed: "+o,e.slideContent=i}var i,s="",a="ll="+e.location.lat.toString()+","+e.location.lng.toString();$.ajax({url:fourSquareURL+"/v2/venues/search",dataType:"json",data:"limit=1&"+a+"&query="+e.name+"&client_id="+kr.foursquare.Client_id+"&client_secret="+kr.foursquare.Client_secret+"&v=20160130",async:!0,error:n}).success(function(e){t(e)})}function NoMap(){alert("Google Map is unavailable just now.\n(you may want to check your internet connection) \n")}function init(){map=new google.maps.Map(document.getElementById("map-div"),mapOptions),model=getModel(),model.spots[0].slideContent||model.spots.forEach(function(e){buildSlideContent(e)}),localStorage.model=JSON.stringify(model),viewModel.spotList(model.spots),infowindow=new google.maps.InfoWindow({}),map.setZoom(model.zoomLevel),map.setCenter(model.center),model.spots.forEach(function(e){eatingSpots.push(new Spot(e))}),google.maps.event.addDomListener(window,"resize",function(){map.setCenter(model.center)})}function filterList(e,t){var o=[],n=new RegExp(e,["i"]);return t.forEach(function(e,t,i){n.test(e.name)&&o.push(e)}),o}function getSpot(e){var t;return eatingSpots.forEach(function(o){o.name==e&&(t=o)}),t}function resetMarkers(e){eatingSpots.forEach(function(e){e.hideMarker()});for(var t in e)getSpot(e[t].name).showMarker()}function itchwindow(){viewModel.openAPIslide(infowindow.anchor.title)}function cleanUpScreen(){infowindow.close(),map.setZoom(model.zoomLevel),map.setCenter(model.center),viewModel.slideOff()}function dubSlideContents(){if(model.spots[0].slideContent)for(var e in model.spots)eatingSpots[e].slideContent=model.spots[e].slideContent,localStorage.model=JSON.stringify(model)}var EatsModel={zoomLevel:18,center:{lat:49.262387,lng:-123.069768},spots:[{name:"Uncle Fatih's Pizza",location:{lat:49.262487,lng:-123.07}},{name:"Buddha's Orient Express",location:{lat:49.262719,lng:-123.069289}},{name:"Booster Juice",location:{lat:49.262641,lng:-123.069438}},{name:"Starbucks Coffee",location:{lat:49.261874,lng:-123.070176}},{name:"Blenz Coffee",location:{lat:49.262534,lng:-123.069529}},{name:"Megabite Pizza",location:{lat:49.262779,lng:-123.069317}},{name:"Broadway Station Sushi",location:{lat:49.262084,lng:-123.070962}}]},model={},fourSquareURL="https://api.foursquare.com",map,eatingSpots=[],infowindow,RedRoadsNGreenBusStops=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",stylers:[{gamma:.65},{hue:"#ff9c30"},{visibility:"on"},{saturation:99},{lightness:-12}]},{featureType:"transit",stylers:[{hue:"#00ff33"},{gamma:.6},{saturation:5},{visibility:"on"},{weight:4.6},{lightness:-12}]}],mapOptions={center:{lat:49.262387,lng:-123.069768},zoom:16,zoomControl:!0,scrollwheel:!1,draggable:!0,disableDoubleClickZoom:!0,disableDefaultUI:!0,styles:RedRoadsNGreenBusStops},Spot=function(e){var t=this;this.name=e.name,this.location=e.location,this.slideContent=e.slideContent,this.marker=new google.maps.Marker({position:this.location,title:this.name,map:map,opacity:.4}),this.windowContent=buildWindowContent(this.marker),this.clickEvent=google.maps.event.addListener(this.marker,"click",function(){t.doOpening()})};Spot.prototype.doOpening=function(){var e=this;cleanUpScreen(),this.marker.setAnimation(google.maps.Animation.BOUNCE),window.setTimeout(function(){e.openWindow(),e.marker.setAnimation(null)},1e3)},Spot.prototype.openWindow=function(){viewModel.listCollapse(),infowindow.setContent(this.windowContent),infowindow.open(map,this.marker)},Spot.prototype.hideMarker=function(){this.marker.setMap(null)},Spot.prototype.showMarker=function(){this.marker.setMap(map)};var ViewModel=function(){var e=this;e.listOn=ko.observable(!0),e.burgerMenu=ko.observable(!1),e.spotList=ko.observableArray(),e.slideOn=ko.observable(!1),e.slideContent=ko.observable(),e.filterSlot=ko.observable(),e.isSelected=ko.observable(!1),e.spotPick=function(){var e=getSpot(this.name);e.doOpening()},e.setFilterSelected=function(){this.isSelected(!0),cleanUpScreen(),e.listExpand()},e.filterSlot.subscribe(function(t){e.listExpand(),e.spotList(filterList(t,eatingSpots)),resetMarkers(e.spotList())}),e.onEnter=function(t,o){return 13===o.keyCode?infowindow.anchor?e.openAPIslide(infowindow.anchor.title):1===e.spotList().length&&e.spotList()[0].doOpening():(infowindow&&infowindow.close(),e.slideOff(),e.listExpand()),!0},e.listCollapse=function(){e.listOn(!1),e.burgerMenu(!0)},e.listExpand=function(){cleanUpScreen(),e.burgerMenu(!1),e.listOn(!0)},e.openAPIslide=function(e){var t=getSpot(e);t.slideContent||dubSlideContents(),viewModel.slideContent(t.slideContent),viewModel.slideOn(!0)},e.slideOff=function(){this.slideOn(!1)}},viewModel=new ViewModel;ko.applyBindings(viewModel);var kr={foursquare:{Owner:"KR Decker",Client_id:"ZVLKTKSGULFEQ3XMWWI3AL1A2KXYBEKD1LKSURUZDGZY41JX",Client_secret:"TMT203DHWOPR3R4RSM1HE4RMOKEWLGTT0FLMZMUZ1OJHMAK1"},yelp:{Consumer_Key:"XrxJOUgGNKq9ZuWhBX1LDw",Consumer_Secret:"zr2I76nT8l0O-trkupYE00B9BTA",Token:"-_F8aOxonR6q5SqvURwwgLIdU-qteS-B",Token_Secret:"GF7uRcPWCpzlHcRP3DiJWjvcXJE"}};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJnZXRNb2RlbCIsImxvY2FsU3RvcmFnZSIsIm1vZGVsIiwiSlNPTiIsInBhcnNlIiwiRWF0c01vZGVsIiwiYnVpbGRXaW5kb3dDb250ZW50IiwibWFya2VyIiwic3RyZWV0dmlld1VybCIsInBvc2l0aW9uIiwidG9TdHJpbmciLCJwaWN0dXJlIiwiY3NzIiwiY29udGVudCIsInRpdGxlIiwiYnVpbGRTbGlkZUNvbnRlbnQiLCJzcG90IiwiZ2V0VmVudWVJbmZvIiwiZGF0YSIsInZlbnVlIiwicmVzcG9uc2UiLCJ2ZW51ZXMiLCIkIiwiYWpheCIsInVybCIsImZvdXJTcXVhcmVVUkwiLCJpZCIsImRhdGFUeXBlIiwibG9jIiwibmFtZSIsImtyIiwiZm91cnNxdWFyZSIsIkNsaWVudF9pZCIsIkNsaWVudF9zZWNyZXQiLCJhc3luYyIsImVycm9yIiwic2VuZEVycm9yIiwic3VjY2VzcyIsImZvcm1hdFNob3dEYXRhIiwiZm9ybWF0dGVkRGF0YSIsImNvbnRhY3QiLCJmb3JtYXR0ZWRQaG9uZSIsImxvY2F0aW9uIiwiYWRkcmVzcyIsImNpdHkiLCJjb3VudHJ5IiwiY3Jvc3NTdHJlZXQiLCJzdGF0cyIsImNoZWNraW5zQ291bnQiLCJsaWtlcyIsInN1bW1hcnkiLCJyYXRpbmdDb2xvciIsInJhdGluZyIsImJlc3RQaG90byIsInByZWZpeCIsInN1ZmZpeCIsInNsaWRlQ29udGVudCIsImNvbnNvbGUiLCJsb2ciLCJvYmplY3QiLCJleGNlcHRpb24iLCJhamF4X2Vycm9yIiwibGF0IiwibG5nIiwiTm9NYXAiLCJhbGVydCIsImluaXQiLCJtYXAiLCJnb29nbGUiLCJtYXBzIiwiTWFwIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsIm1hcE9wdGlvbnMiLCJzcG90cyIsImZvckVhY2giLCJzdHJpbmdpZnkiLCJ2aWV3TW9kZWwiLCJzcG90TGlzdCIsImluZm93aW5kb3ciLCJJbmZvV2luZG93Iiwic2V0Wm9vbSIsInpvb21MZXZlbCIsInNldENlbnRlciIsImNlbnRlciIsImVhdGluZ1Nwb3RzIiwicHVzaCIsIlNwb3QiLCJldmVudCIsImFkZERvbUxpc3RlbmVyIiwid2luZG93IiwiZmlsdGVyTGlzdCIsInVzZXJUZXh0IiwibW9kZWxBcnJheSIsInJlc3VsdCIsInJlIiwiUmVnRXhwIiwiZWxlbWVudCIsImluZGV4IiwiYXJyYXkiLCJ0ZXN0IiwiZ2V0U3BvdCIsInJlc2V0TWFya2VycyIsImhpZGVNYXJrZXIiLCJpIiwic2hvd01hcmtlciIsIml0Y2h3aW5kb3ciLCJvcGVuQVBJc2xpZGUiLCJhbmNob3IiLCJjbGVhblVwU2NyZWVuIiwiY2xvc2UiLCJzbGlkZU9mZiIsImR1YlNsaWRlQ29udGVudHMiLCJSZWRSb2Fkc05HcmVlbkJ1c1N0b3BzIiwiZmVhdHVyZVR5cGUiLCJlbGVtZW50VHlwZSIsInN0eWxlcnMiLCJ2aXNpYmlsaXR5IiwiZ2FtbWEiLCJodWUiLCJzYXR1cmF0aW9uIiwibGlnaHRuZXNzIiwid2VpZ2h0Iiwiem9vbSIsInpvb21Db250cm9sIiwic2Nyb2xsd2hlZWwiLCJkcmFnZ2FibGUiLCJkaXNhYmxlRG91YmxlQ2xpY2tab29tIiwiZGlzYWJsZURlZmF1bHRVSSIsInN0eWxlcyIsInRoYXQiLCJ0aGlzIiwiTWFya2VyIiwib3BhY2l0eSIsIndpbmRvd0NvbnRlbnQiLCJjbGlja0V2ZW50IiwiYWRkTGlzdGVuZXIiLCJkb09wZW5pbmciLCJwcm90b3R5cGUiLCJzZXRBbmltYXRpb24iLCJBbmltYXRpb24iLCJCT1VOQ0UiLCJzZXRUaW1lb3V0Iiwib3BlbldpbmRvdyIsImxpc3RDb2xsYXBzZSIsInNldENvbnRlbnQiLCJvcGVuIiwic2V0TWFwIiwiVmlld01vZGVsIiwic2VsZiIsImxpc3RPbiIsImtvIiwib2JzZXJ2YWJsZSIsImJ1cmdlck1lbnUiLCJvYnNlcnZhYmxlQXJyYXkiLCJzbGlkZU9uIiwiZmlsdGVyU2xvdCIsImlzU2VsZWN0ZWQiLCJzcG90UGljayIsInNldEZpbHRlclNlbGVjdGVkIiwibGlzdEV4cGFuZCIsInN1YnNjcmliZSIsIm9uRW50ZXIiLCJrZXlDb2RlIiwibGVuZ3RoIiwic3BvdE5hbWUiLCJhcHBseUJpbmRpbmdzIiwiT3duZXIiLCJ5ZWxwIiwiQ29uc3VtZXJfS2V5IiwiQ29uc3VtZXJfU2VjcmV0IiwiVG9rZW4iLCJUb2tlbl9TZWNyZXQiXSwibWFwcGluZ3MiOiJBQThDQSxRQUFTQSxZQUNMLE1BQUlDLGNBQWFDLE1BQ05DLEtBQUtDLE1BQU1ILGFBQWFDLE9BRXhCRyxVQUlmLFFBQVNDLG9CQUFtQkMsR0FDeEIsR0FBSUMsR0FBZ0Isd0VBQ0lELEVBQU9FLFNBQVNDLFdBQ3BDQyxFQUFVLDJCQUE2QkgsRUFBZ0IsS0FDdkRJLEVBQU0sMEJBQ05DLEVBQVUscUNBQ0VELEVBQU0sSUFBTUQsRUFBVSxxQ0FDdEJKLEVBQU9PLE1BQVEsdUVBRy9CLE9BQU9ELEdBT1gsUUFBU0UsbUJBQWtCQyxHQW1CdkIsUUFBU0MsR0FBYUMsR0FDbEIsR0FBSUMsR0FBUUQsRUFBS0UsU0FBU0MsT0FBTyxFQUVqQ0MsR0FBRUMsTUFDRUMsSUFBS0MsY0FBZ0IsY0FBZ0JOLEVBQU1PLEdBQzNDQyxTQUFVLE9BQ1ZULEtBQU0sV0FDUVUsRUFDTixVQUFZWixFQUFLYSxLQUNqQixjQUFlQyxHQUFHQyxXQUFXQyxVQUM3QixrQkFBbUJGLEdBQUdDLFdBQVdFLGNBQ2pDLGNBQ1JDLE9BQU8sRUFFUEMsTUFBT0MsSUFDWkMsUUFBUSxTQUFTakIsR0FDZGtCLEVBQWVsQixLQUdyQixRQUFTa0IsR0FBZXBCLEdBQ3BCLEdBQUlDLEdBQVFELEVBQUtFLFNBQVNELEtBQzFCb0IsR0FBZ0IsNEJBQ2tCcEIsRUFBTVUsS0FBTyxPQUMvQlYsRUFBTXFCLFFBQVFDLGVBQWlCLFNBQ3hCdEIsRUFBTXVCLFNBQVNDLFFBQVUsU0FDekJ4QixFQUFNdUIsU0FBU0UsS0FBUSxTQUN2QnpCLEVBQU11QixTQUFTRyxRQUFXLGlCQUNsQjFCLEVBQU11QixTQUFTSSxZQUFjLGtCQUM1QjNCLEVBQU00QixNQUFNQyxj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QUthLFFBQVUsU0FBVWhKLEVBQU1zRSxHQWdCM0IsTUFmc0IsTUFBbEJBLEVBQU0yRSxRQUNGcEYsV0FBVzZCLE9BQ1R5QyxFQUFLMUMsYUFBYTVCLFdBQVc2QixPQUFPOUYsT0FHUCxJQUEzQnVJLEVBQUt2RSxXQUFXc0YsUUFDaEJmLEVBQUt2RSxXQUFXLEdBQUcyRCxhQUt2QjFELFlBQVlBLFdBQVcrQixRQUMzQnVDLEVBQUt0QyxXQUNMc0MsRUFBS1csZUFFRixHQUVYWCxFQUFLTCxhQUFlLFdBQ2hCSyxFQUFLQyxRQUFPLEdBQ1pELEVBQUtJLFlBQVcsSUFFcEJKLEVBQUtXLFdBQWEsV0FDZG5ELGdCQUNBd0MsRUFBS0ksWUFBVyxHQUNoQkosRUFBS0MsUUFBTyxJQUVoQkQsRUFBSzFDLGFBQWUsU0FBVTBELEdBQzFCLEdBQUlySixHQUFPcUYsUUFBUWdFLEVBQ2JySixHQUFpQixjQUNuQmdHLG1CQUVKbkMsVUFBVXJCLGFBQWF4QyxFQUFLd0MsY0FDNUJxQixVQUFVOEUsU0FBUSxJQUV0Qk4sRUFBS3RDLFNBQVcsV0FDWm9CLEtBQUt3QixTQUFRLEtBSWpCOUUsVUFBWSxHQUFJdUUsVUFDcEJHLElBQUdlLGNBQWN6RixVQXFJakIsSUFBSS9DLEtBQ0FDLFlBQ0l3SSxNQUFPLFlBQ1B2SSxVQUFXLG1EQUNYQyxjQUFlLG9EQUVuQnVJLE1BQ0lDLGFBQWlCLHlCQUNqQkMsZ0JBQWlCLDhCQUNqQkMsTUFBUyxtQ0FDVEMsYUFBaUIiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9NT0RFTC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuLy8gZWF0cyBkYXRhOiBhbiBhcnJheSBvZiBwbGFjZXMgdG8gZWF0XG4vLyBhcm91bmQgQ29tbWVyY2lhbC1Ccm9hZHdheSBTdGF0aW9uXG4vLyBFYXN0IFZhblxuLy8gQnJpdGlzaCBDb2x1bWJpYVxuXG4vLyBiYXNpYyBkYXRhLCBsb2FkZWQgaWYgbW9yZSBkZXRhaWxlZCBtb2RlbCBub3QgZm91bmQgaW4gbG9jYWxTdG9yYWdlXG52YXIgRWF0c01vZGVsID0ge1xuICAgIHpvb21MZXZlbDogMTgsXG4gICAgY2VudGVyOiB7bGF0OiA0OS4yNjIzODcsIGxuZzogLTEyMy4wNjk3Njh9LC8vNDkuMjYyMzg3LCAtMTIzLjA2OTc2OFxuICAgIHNwb3RzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIG5hbWU6IFwiVW5jbGUgRmF0aWgncyBQaXp6YVwiLFxuICAgICAgICAgICAgbG9jYXRpb246IHtsYXQ6IDQ5LjI2MjQ4NywgbG5nOiAtMTIzLjA3MDAwMH0gLy93YXMgLjI2MjUxNyAuMDcwMTc3XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIG5hbWU6IFwiQnVkZGhhJ3MgT3JpZW50IEV4cHJlc3NcIixcbiAgICAgICAgICAgIGxvY2F0aW9uOiB7bGF0OiA0OS4yNjI3MTksIGxuZzogLTEyMy4wNjkyODl9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIG5hbWU6IFwiQm9vc3RlciBKdWljZVwiLFxuICAgICAgICAgICAgbG9jYXRpb246IHtsYXQ6IDQ5LjI2MjY0MSwgbG5nOiAtMTIzLjA2OTQzOH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogXCJTdGFyYnVja3MgQ29mZmVlXCIsXG4gICAgICAgICAgICBsb2NhdGlvbjoge2xhdDogNDkuMjYxODc0LCBsbmc6IC0xMjMuMDcwMTc2fVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiBcIkJsZW56IENvZmZlZVwiLFxuICAgICAgICAgICAgbG9jYXRpb246IHtsYXQ6IDQ5LjI2MjUzNCwgbG5nOiAtMTIzLjA2OTUyOX1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogXCJNZWdhYml0ZSBQaXp6YVwiLFxuICAgICAgICAgICAgbG9jYXRpb246IHtsYXQ6IDQ5LjI2Mjc3OSwgbG5nOiAtMTIzLjA2OTMxN31cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogXCJCcm9hZHdheSBTdGF0aW9uIFN1c2hpXCIsXG4gICAgICAgICAgICBsb2NhdGlvbjoge2xhdDogNDkuMjYyMDg0LCBsbmc6IC0xMjMuMDcwOTYyfVxuICAgICAgICB9XG4gICAgXVxufTtcblxudmFyIG1vZGVsID0ge307XG5cbmZ1bmN0aW9uIGdldE1vZGVsKCkge1xuICAgIGlmIChsb2NhbFN0b3JhZ2UubW9kZWwpIHtcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLm1vZGVsKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gRWF0c01vZGVsO1xuICAgIH07XG59O1xuXG5mdW5jdGlvbiBidWlsZFdpbmRvd0NvbnRlbnQobWFya2VyKSB7XG4gICAgdmFyIHN0cmVldHZpZXdVcmwgPSAnaHR0cDovL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvc3RyZWV0dmlldz9zaXplPTIwMHgxNTAmbG9jYXRpb249JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFya2VyLnBvc2l0aW9uLnRvU3RyaW5nKCkgKyAnJztcbiAgICB2YXIgcGljdHVyZSA9ICc8aW1nIGNsYXNzPVwiYmdpbWdcIiBzcmM9XCInICsgc3RyZWV0dmlld1VybCArICdcIj4nO1xuICAgIHZhciBjc3MgPSAnXCJoZWlnaHQ6MTAwJTt3aWR0aDo4MCVcIic7XG4gICAgdmFyIGNvbnRlbnQgPSAnPGRpdiBvbmNsaWNrPVwiaXRjaHdpbmRvdygpXCIgc3R5bGU9JyArXG4gICAgICAgICAgICAgICAgICAgIGNzcyArICc+JyArIHBpY3R1cmUgKyAnPGJyPjxzcGFuIHN0eWxlPVwiY29sb3I6ZGFya2dyZWVuXCI+JyArXG4gICAgICAgICAgICAgICAgICAgIG1hcmtlci50aXRsZSArICc8L3NwYW4+JyArXG4gICAgICAgICAgICAgICAgICAgICc8YnI+PHNwYW4gc3R5bGU9XCJjb2xvcjpyZWRcIj4tQ0xJQ0sgRk9SIE1PUkUgSU5GTy08L3NwYW4+PC9kaXY+JztcblxuICAgIHJldHVybiBjb250ZW50O1xufVxuXG4vLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIDNyZCBwYXJ0eSBBUEkgc3R1ZmZcbnZhciBmb3VyU3F1YXJlVVJMID0gJ2h0dHBzOi8vYXBpLmZvdXJzcXVhcmUuY29tJztcblxuZnVuY3Rpb24gYnVpbGRTbGlkZUNvbnRlbnQoc3BvdCkge1xuICAgIHZhciBmb3JtYXR0ZWREYXRhID0gXCJcIjtcbiAgICB2YXIgbG9jID0gXCJsbD1cIiArIHNwb3QubG9jYXRpb24ubGF0LnRvU3RyaW5nKCkgKyBcIixcIiArIHNwb3QubG9jYXRpb24ubG5nLnRvU3RyaW5nKCk7XG4gICAgdmFyIGFqYXhfZXJyb3I7XG4gICAgLy8gZ2V0IHRoZSBmb3Vyc3F1YXJlIElEIG51bWJlciBvZiB0aGUgc3BvdFxuICAgICQuYWpheCh7XG4gICAgICAgICAgICB1cmw6IGZvdXJTcXVhcmVVUkwgKyAnL3YyL3ZlbnVlcy9zZWFyY2gnLFxuICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgIGRhdGE6ICdsaW1pdD0xJyArXG4gICAgICAgICAgICAgICAgICAgICcmJyArIGxvYyArICcmcXVlcnk9JyArIHNwb3QubmFtZSArXG4gICAgICAgICAgICAgICAgICAgICcmY2xpZW50X2lkPScrIGtyLmZvdXJzcXVhcmUuQ2xpZW50X2lkICtcbiAgICAgICAgICAgICAgICAgICAgJyZjbGllbnRfc2VjcmV0PScrIGtyLmZvdXJzcXVhcmUuQ2xpZW50X3NlY3JldCArXG4gICAgICAgICAgICAgICAgICAgICcmdj0yMDE2MDEzMCcsXG4gICAgICAgICAgICBhc3luYzogdHJ1ZSxcbiAgICAgICAgICAgIC8vc3VjY2VzczogLFxuICAgICAgICAgICAgZXJyb3I6IHNlbmRFcnJvclxuICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAgIGdldFZlbnVlSW5mbyhyZXNwb25zZSk7XG4gICAgICAgIH0pO1xuICAgIGZ1bmN0aW9uIGdldFZlbnVlSW5mbyhkYXRhKSB7XG4gICAgICAgIHZhciB2ZW51ZSA9IGRhdGEucmVzcG9uc2UudmVudWVzWzBdO1xuICAgICAgICAvL2h0dHBzOi8vYXBpLmZvdXJzcXVhcmUuY29tL3YyL3ZlbnVlcy9WRU5VRV9JRFxuICAgICAgICAkLmFqYXgoeyAvLyB0byBnZXQgdGhlIGRldGFpbGVkIGZvdXJzcXVhcmUgb2YgdGhlICdjb21wbGV0ZSB2ZW51ZScgYmFzZWQgb24gSURcbiAgICAgICAgICAgIHVybDogZm91clNxdWFyZVVSTCArICcvdjIvdmVudWVzLycgKyB2ZW51ZS5pZCxcbiAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICBkYXRhOiAnbGltaXQ9MScgK1xuICAgICAgICAgICAgICAgICAgICAnJicgKyBsb2MgK1xuICAgICAgICAgICAgICAgICAgICAnJnF1ZXJ5PScgKyBzcG90Lm5hbWUgK1xuICAgICAgICAgICAgICAgICAgICAnJmNsaWVudF9pZD0nKyBrci5mb3Vyc3F1YXJlLkNsaWVudF9pZCArXG4gICAgICAgICAgICAgICAgICAgICcmY2xpZW50X3NlY3JldD0nKyBrci5mb3Vyc3F1YXJlLkNsaWVudF9zZWNyZXQgK1xuICAgICAgICAgICAgICAgICAgICAnJnY9MjAxNjAxMzAnLFxuICAgICAgICAgICAgYXN5bmM6IHRydWUsXG4gICAgICAgICAgICAvL3N1Y2Nlc3M6ICxcbiAgICAgICAgICAgIGVycm9yOiBzZW5kRXJyb3JcbiAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICBmb3JtYXRTaG93RGF0YShyZXNwb25zZSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBmb3JtYXRTaG93RGF0YShkYXRhKXtcbiAgICAgICAgdmFyIHZlbnVlID0gZGF0YS5yZXNwb25zZS52ZW51ZTtcbiAgICAgICAgZm9ybWF0dGVkRGF0YSA9ICdGb3VyU3F1YXJlIGluZm86ICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgJzxicj4nICsgJzxicj4nICsgdmVudWUubmFtZSArICc8YnI+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICB2ZW51ZS5jb250YWN0LmZvcm1hdHRlZFBob25lICsgJzxicj4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICctICcgKyB2ZW51ZS5sb2NhdGlvbi5hZGRyZXNzICsgJzxicj4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICctICcgKyB2ZW51ZS5sb2NhdGlvbi5jaXR5ICArICc8YnI+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAnLSAnICsgdmVudWUubG9jYXRpb24uY291bnRyeSAgKyAnPGJyPicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgJ3gtc3RyZWV0OiAnICsgdmVudWUubG9jYXRpb24uY3Jvc3NTdHJlZXQgKyAnPGJyPicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgJ0NoZWNrLWluczogJyArIHZlbnVlLnN0YXRzLmNoZWNraW5zQ291bnQudG9TdHJpbmcoKSArXG4gICAgICAgICAgICAgICAgICAgICAgICAnPGJyPicgKyB2ZW51ZS5saWtlcy5zdW1tYXJ5ICsgJzxicj4nICsgJzxicj4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICc8c3BhbiBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6IycgKyB2ZW51ZS5yYXRpbmdDb2xvciArXG4gICAgICAgICAgICAgICAgICAgICAgICAnO2NvbG9yOmJsYWNrO3BhZGRpbmc6MSVcIj4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICdSYXRpbmc6ICcgKyB2ZW51ZS5yYXRpbmcudG9TdHJpbmcoKSArXG4gICAgICAgICAgICAgICAgICAgICAgICAnPC9zcGFuPicgKyAnPGJyPicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgJzxpbWcgc3JjPVwiJyArIHZlbnVlLmJlc3RQaG90by5wcmVmaXggK1xuICAgICAgICAgICAgICAgICAgICAgICAgJ2NhcDMwMCcgKyB2ZW51ZS5iZXN0UGhvdG8uc3VmZml4ICsgJ1wiPidcbiAgICAgICAgICAgICAgICAgICAgICAgIDtcbiAgICAgICAgc3BvdC5zbGlkZUNvbnRlbnQgPSBmb3JtYXR0ZWREYXRhO1xuICAgICAgICBjb25zb2xlLmxvZyhzcG90LnNsaWRlQ29udGVudCk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHNlbmRFcnJvcihvYmplY3QsIGVycm9yLCBleGNlcHRpb24pIHtcbiAgICAgICAgYWpheF9lcnJvciA9IFwiV2ViIGNhbGwgZmFpbGVkOiBcIiArIGVycm9yIDtcbiAgICAgICAgc3BvdC5zbGlkZUNvbnRlbnQgPSBhamF4X2Vycm9yO1xuICAgIH1cbn1cblxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL01BUCBWSUVXTU9ERUwvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxudmFyIG1hcDtcbnZhciBlYXRpbmdTcG90cyA9IFtdO1xudmFyIGluZm93aW5kb3c7XG5cbnZhciBSZWRSb2Fkc05HcmVlbkJ1c1N0b3BzID0gW1xuICB7XG4gICAgXCJmZWF0dXJlVHlwZVwiOiBcInBvaVwiLFxuICAgIFwiZWxlbWVudFR5cGVcIjogXCJsYWJlbHNcIixcbiAgICBcInN0eWxlcnNcIjogW1xuICAgICAgICB7IHZpc2liaWxpdHk6IFwib2ZmXCIgfVxuICAgIF1cbiAgfSxcbiAge1xuICAgIFwiZmVhdHVyZVR5cGVcIjogXCJyb2FkXCIsXG4gICAgXCJzdHlsZXJzXCI6IFtcbiAgICAgIHsgXCJnYW1tYVwiOiAwLjY1IH0sXG4gICAgICB7IFwiaHVlXCI6IFwiI2ZmOWMzMFwiIH0sXG4gICAgICB7IFwidmlzaWJpbGl0eVwiOiBcIm9uXCIgfSxcbiAgICAgIHsgXCJzYXR1cmF0aW9uXCI6IDk5IH0sXG4gICAgICB7IFwibGlnaHRuZXNzXCI6IC0xMiB9XG4gICAgXVxuICB9LHtcbiAgICBcImZlYXR1cmVUeXBlXCI6IFwidHJhbnNpdFwiLFxuICAgIFwic3R5bGVyc1wiOiBbXG4gICAgICB7IFwiaHVlXCI6IFwiIzAwZmYzM1wiIH0sXG4gICAgICB7IFwiZ2FtbWFcIjogMC42MCB9LFxuICAgICAgeyBcInNhdHVyYXRpb25cIjogNSB9LFxuICAgICAgeyBcInZpc2liaWxpdHlcIjogXCJvblwiIH0sXG4gICAgICB7IFwid2VpZ2h0XCI6IDQuNiB9LFxuICAgICAgeyBcImxpZ2h0bmVzc1wiOiAtMTIgfSAvL3dhcyAtMjJcbiAgICBdXG4gIH1cbl07XG5cbnZhciBtYXBPcHRpb25zID0ge1xuICAgICAgICBjZW50ZXI6IHtsYXQ6IDQ5LjI2MjM4NywgbG5nOiAtMTIzLjA2OTc2OH0sLy80OS4yNjIzODcsIC0xMjMuMDY5NzY4XG4gICAgICAgIC8vIENvbW1lcmNpYWwgQnJvYWR3YXkgU3RhdGlvbiA0OcKwMTXigLI0NeKAs04sIDEyM8KwMDTigLIwOOKAs1dcbiAgICAgICAgem9vbTogMTYsXG4gICAgICAgIHpvb21Db250cm9sOiB0cnVlLFxuICAgICAgICBzY3JvbGx3aGVlbDogZmFsc2UsXG4gICAgICAgIGRyYWdnYWJsZTogdHJ1ZSxcbiAgICAgICAgZGlzYWJsZURvdWJsZUNsaWNrWm9vbTogdHJ1ZSxcbiAgICAgICAgZGlzYWJsZURlZmF1bHRVSTogdHJ1ZSxcbiAgICAgICAgc3R5bGVzOiBSZWRSb2Fkc05HcmVlbkJ1c1N0b3BzXG4gICAgfTtcblxuZnVuY3Rpb24gTm9NYXAoKSB7XG4gICAgYWxlcnQoXCJHb29nbGUgTWFwIGlzIHVuYXZhaWxhYmxlIGp1c3Qgbm93LlxcblwiICtcbiAgICAgICAgXCIoeW91IG1heSB3YW50IHRvIGNoZWNrIHlvdXIgaW50ZXJuZXQgY29ubmVjdGlvbikgXFxuXCIpO1xufVxuXG4vLyBpbnZva2VkIGJ5IG1hcCA8c2NyaXB0PiBpbiBpbmRleC5odG1sXG5mdW5jdGlvbiBpbml0KCkge1xuICAgIG1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcC1kaXYnKSwgbWFwT3B0aW9ucyApO1xuICAgIG1vZGVsID0gZ2V0TW9kZWwoKTsgLy8gbG9hZCBkYXRhIG9iamVjdCBlaXRoZXIgZnJvbSBsb2NhbFN0b3JhZ2Ugb3IgZmlsZVxuICAgIC8vIHRoZW4gYnVpbGQgdGhlIHNsaWRlIGNvbnRlbnQgd2l0aCBhamF4IGFwaSBjYWxscywgaWYgbmVjZXNzYXJ5XG4gICAgaWYgKCEobW9kZWwuc3BvdHNbMF0uc2xpZGVDb250ZW50KSkge1xuICAgICAgICBtb2RlbC5zcG90cy5mb3JFYWNoKCBmdW5jdGlvbiAoc3BvdCkge1xuICAgICAgICAgICAgYnVpbGRTbGlkZUNvbnRlbnQoc3BvdCk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgbG9jYWxTdG9yYWdlLm1vZGVsID0gSlNPTi5zdHJpbmdpZnkobW9kZWwpO1xuICAgIHZpZXdNb2RlbC5zcG90TGlzdChtb2RlbC5zcG90cyk7XG4gICAgaW5mb3dpbmRvdyA9IG5ldyBnb29nbGUubWFwcy5JbmZvV2luZG93KHt9KTtcbiAgICBtYXAuc2V0Wm9vbShtb2RlbC56b29tTGV2ZWwpO1xuICAgIG1hcC5zZXRDZW50ZXIobW9kZWwuY2VudGVyKTtcbiAgICBtb2RlbC5zcG90cy5mb3JFYWNoKCBmdW5jdGlvbihzcG90KSB7XG4gICAgICAgIGVhdGluZ1Nwb3RzLnB1c2gobmV3IFNwb3Qoc3BvdCkpO1xuICAgIH0pO1xuICAgIC8vIHN0YXkgY2VudHJlZFxuICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZERvbUxpc3RlbmVyKHdpbmRvdywgJ3Jlc2l6ZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICBtYXAuc2V0Q2VudGVyKG1vZGVsLmNlbnRlcik7XG4gICAgfSk7XG59XG5cbi8vIGNvbnN0cnVjdG9yXG52YXIgU3BvdCA9IGZ1bmN0aW9uKGRhdGEpIHtcbiAgdmFyIHRoYXQgPSB0aGlzO1xuICB0aGlzLm5hbWUgPSBkYXRhLm5hbWU7XG4gIHRoaXMubG9jYXRpb24gPSBkYXRhLmxvY2F0aW9uO1xuICB0aGlzLnNsaWRlQ29udGVudCA9IGRhdGEuc2xpZGVDb250ZW50O1xuICB0aGlzLm1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xuICAgICAgICBwb3NpdGlvbjogdGhpcy5sb2NhdGlvbixcbiAgICAgICAgdGl0bGU6IHRoaXMubmFtZSxcbiAgICAgICAgbWFwOiBtYXAsXG4gICAgICAgIG9wYWNpdHk6IDAuNFxuICB9KTtcbiAgdGhpcy53aW5kb3dDb250ZW50ID0gYnVpbGRXaW5kb3dDb250ZW50KHRoaXMubWFya2VyKTtcbiAgdGhpcy5jbGlja0V2ZW50ID0gZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIodGhpcy5tYXJrZXIsIFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGF0LmRvT3BlbmluZygpO1xuICAgIH0pO1xufTtcblxuU3BvdC5wcm90b3R5cGUuZG9PcGVuaW5nID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICBjbGVhblVwU2NyZWVuKCk7XG4gICAgdGhpcy5tYXJrZXIuc2V0QW5pbWF0aW9uKGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5CT1VOQ0UpO1xuICAgIHdpbmRvdy5zZXRUaW1lb3V0KCBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhhdC5vcGVuV2luZG93KCk7XG4gICAgICAgIHRoYXQubWFya2VyLnNldEFuaW1hdGlvbihudWxsKTtcbiAgICB9LCAxMDAwKTtcbn07XG5cblNwb3QucHJvdG90eXBlLm9wZW5XaW5kb3cgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmlld01vZGVsLmxpc3RDb2xsYXBzZSgpO1xuICAgIGluZm93aW5kb3cuc2V0Q29udGVudCh0aGlzLndpbmRvd0NvbnRlbnQpO1xuICAgIGluZm93aW5kb3cub3BlbihtYXAsIHRoaXMubWFya2VyKTtcbn1cblxuU3BvdC5wcm90b3R5cGUuaGlkZU1hcmtlciA9IGZ1bmN0aW9uICgpIHsgdGhpcy5tYXJrZXIuc2V0TWFwKG51bGwpOyB9O1xuU3BvdC5wcm90b3R5cGUuc2hvd01hcmtlciA9IGZ1bmN0aW9uICgpIHsgdGhpcy5tYXJrZXIuc2V0TWFwKG1hcCk7IH07XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9LTyBWSUVXTU9ERUwvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbnZhciBWaWV3TW9kZWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgLy8gRGF0YVxuICAgIHNlbGYubGlzdE9uID0ga28ub2JzZXJ2YWJsZSh0cnVlKTtcbiAgICBzZWxmLmJ1cmdlck1lbnUgPSBrby5vYnNlcnZhYmxlKGZhbHNlKTtcbiAgICBzZWxmLnNwb3RMaXN0ID0ga28ub2JzZXJ2YWJsZUFycmF5KCk7XG4gICAgc2VsZi5zbGlkZU9uID0ga28ub2JzZXJ2YWJsZShmYWxzZSk7XG4gICAgc2VsZi5zbGlkZUNvbnRlbnQgPSBrby5vYnNlcnZhYmxlKCk7XG4gICAgc2VsZi5maWx0ZXJTbG90ID0ga28ub2JzZXJ2YWJsZSgpO1xuICAgIHNlbGYuaXNTZWxlY3RlZCA9IGtvLm9ic2VydmFibGUoZmFsc2UpO1xuXG4gICAgLy8gQmVoYXZpb3Vyc1xuICAgIHNlbGYuc3BvdFBpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzcG90ID0gZ2V0U3BvdCh0aGlzLm5hbWUpO1xuICAgICAgICBzcG90LmRvT3BlbmluZygpO1xuICAgIH07XG4gICAgc2VsZi5zZXRGaWx0ZXJTZWxlY3RlZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmlzU2VsZWN0ZWQodHJ1ZSk7XG4gICAgICAgIGNsZWFuVXBTY3JlZW4oKTtcbiAgICAgICAgc2VsZi5saXN0RXhwYW5kKCk7XG4gICAgfTtcbiAgICBzZWxmLmZpbHRlclNsb3Quc3Vic2NyaWJlKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgc2VsZi5saXN0RXhwYW5kKCk7XG4gICAgICAgIHNlbGYuc3BvdExpc3QoZmlsdGVyTGlzdChkYXRhLCBlYXRpbmdTcG90cykpO1xuICAgICAgICByZXNldE1hcmtlcnMoc2VsZi5zcG90TGlzdCgpKTtcbiAgICB9KTtcbiAgICBzZWxmLm9uRW50ZXIgPSBmdW5jdGlvbiAoZGF0YSwgZXZlbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzKSB7XG4gICAgICAgICAgICBpZiAoaW5mb3dpbmRvdy5hbmNob3IpIHtcbiAgICAgICAgICAgICAgICAgIHNlbGYub3BlbkFQSXNsaWRlKGluZm93aW5kb3cuYW5jaG9yLnRpdGxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChzZWxmLnNwb3RMaXN0KCkubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc3BvdExpc3QoKVswXS5kb09wZW5pbmcoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAoaW5mb3dpbmRvdykgaW5mb3dpbmRvdy5jbG9zZSgpOyAvL2ZvciBhbnkgb3RoZXIga2V5cHJlc3NcbiAgICAgICAgICAgIHNlbGYuc2xpZGVPZmYoKTtcbiAgICAgICAgICAgIHNlbGYubGlzdEV4cGFuZCgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlOyAvLyBuZWNlc3NhcnkgdG8gcmVmbGVjdCB0aGUgdGV4dCBpbiB0aGUgc2xvdFxuICAgIH07XG4gICAgc2VsZi5saXN0Q29sbGFwc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlbGYubGlzdE9uKGZhbHNlKTtcbiAgICAgICAgc2VsZi5idXJnZXJNZW51KHRydWUpO1xuICAgIH07XG4gICAgc2VsZi5saXN0RXhwYW5kID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBjbGVhblVwU2NyZWVuKCk7XG4gICAgICAgIHNlbGYuYnVyZ2VyTWVudShmYWxzZSk7XG4gICAgICAgIHNlbGYubGlzdE9uKHRydWUpO1xuICAgIH07XG4gICAgc2VsZi5vcGVuQVBJc2xpZGUgPSBmdW5jdGlvbiAoc3BvdE5hbWUpIHtcbiAgICAgICAgdmFyIHNwb3QgPSBnZXRTcG90KHNwb3ROYW1lKTtcbiAgICAgICAgaWYgKCEoc3BvdC5zbGlkZUNvbnRlbnQpKSB7XG4gICAgICAgICAgICBkdWJTbGlkZUNvbnRlbnRzKCk7XG4gICAgICAgIH07XG4gICAgICAgIHZpZXdNb2RlbC5zbGlkZUNvbnRlbnQoc3BvdC5zbGlkZUNvbnRlbnQpO1xuICAgICAgICB2aWV3TW9kZWwuc2xpZGVPbih0cnVlKTtcbiAgICB9O1xuICAgIHNlbGYuc2xpZGVPZmYgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuc2xpZGVPbihmYWxzZSk7XG4gICAgfTtcbn07XG5cbnZhciB2aWV3TW9kZWwgPSBuZXcgVmlld01vZGVsKCk7XG5rby5hcHBseUJpbmRpbmdzKHZpZXdNb2RlbCk7XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tSEVMUEVSIEZVTkNUSU9OUy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy9cbi8vdGVzdCBhcnJheSBhZ2FpbnN0IGEgcmVndWxhciBleHByZXNzaW9uXG5mdW5jdGlvbiBmaWx0ZXJMaXN0KHVzZXJUZXh0LCBtb2RlbEFycmF5KSB7XG4gICAgIHZhciByZXN1bHQ9W10sXG4gICAgICAgICByZSA9IG5ldyBSZWdFeHAodXNlclRleHQsIFsnaSddKTtcblxuICAgICBtb2RlbEFycmF5LmZvckVhY2goIGZ1bmN0aW9uKGVsZW1lbnQsIGluZGV4LCBhcnJheSkge1xuICAgICAgICBpZiAocmUudGVzdChlbGVtZW50Lm5hbWUpKSByZXN1bHQucHVzaChlbGVtZW50KTtcbiAgICAgfSk7XG5cbiAgICAgcmV0dXJuIHJlc3VsdDtcbn1cbmZ1bmN0aW9uIGdldFNwb3QobmFtZSkge1xuICAgIHZhciByZXN1bHQ7XG4gICAgZWF0aW5nU3BvdHMuZm9yRWFjaCggZnVuY3Rpb24oc3BvdCkge1xuICAgICAgIGlmIChzcG90Lm5hbWUgPT0gbmFtZSkgcmVzdWx0ID0gc3BvdDtcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0O1xufVxuZnVuY3Rpb24gcmVzZXRNYXJrZXJzKHNwb3RzKSB7XG4gICAgZWF0aW5nU3BvdHMuZm9yRWFjaCggZnVuY3Rpb24oc3BvdCkge1xuICAgICAgICBzcG90LmhpZGVNYXJrZXIoKTtcbiAgICB9KTtcbiAgICBmb3IgKHZhciBpIGluIHNwb3RzKSB7XG4gICAgICAgIGdldFNwb3Qoc3BvdHNbaV0ubmFtZSkuc2hvd01hcmtlcigpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGl0Y2h3aW5kb3coKSB7XG4gICAgdmlld01vZGVsLm9wZW5BUElzbGlkZShpbmZvd2luZG93LmFuY2hvci50aXRsZSk7XG59XG5mdW5jdGlvbiBjbGVhblVwU2NyZWVuKCkge1xuICAgIGluZm93aW5kb3cuY2xvc2UoKTtcbiAgICBtYXAuc2V0Wm9vbShtb2RlbC56b29tTGV2ZWwpO1xuICAgIG1hcC5zZXRDZW50ZXIobW9kZWwuY2VudGVyKTtcbiAgICB2aWV3TW9kZWwuc2xpZGVPZmYoKTtcbn1cbmZ1bmN0aW9uIGR1YlNsaWRlQ29udGVudHMoKSB7XG4gICAgaWYgKG1vZGVsLnNwb3RzWzBdLnNsaWRlQ29udGVudCkge1xuICAgICAgICBmb3IgKHZhciBpIGluIG1vZGVsLnNwb3RzKSB7XG4gICAgICAgICAgICBlYXRpbmdTcG90c1tpXS5zbGlkZUNvbnRlbnQgPSBtb2RlbC5zcG90c1tpXS5zbGlkZUNvbnRlbnQ7XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2UubW9kZWwgPSBKU09OLnN0cmluZ2lmeShtb2RlbCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cblxuXG5cblxuLy89PT09PT09PT09PT09PT09PT09VEhFIEVORD09PT09PT09PT09PT09PT09PT1cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuLy9mcm9tIGh0dHBzOi8vZGV2ZWxvcGVyLmZvdXJzcXVhcmUuY29tL292ZXJ2aWV3L2F1dGgjdXNlcmxlc3Ncbi8vaHR0cHM6Ly9hcGkuZm91cnNxdWFyZS5jb20vdjIvdmVudWVzL3NlYXJjaD9sbD00MC43LC03NCZjbGllbnRfaWQ9Q0xJRU5UX0lEJmNsaWVudF9zZWNyZXQ9Q0xJRU5UX1NFQ1JFVCZ2PVlZWVlNTUREXG5cbi8vZm91cnNxdWFyZS5jb20vdi9icm9hZHdheS1zdGF0aW9uLXN1c2hpLzRhYWU5Y2I3Zjk2NGE1MjA5YjYyMjBlM1xudmFyIGtyID0ge1xuICAgIGZvdXJzcXVhcmU6IHtcbiAgICAgICAgT3duZXI6IFwiS1IgRGVja2VyXCIsXG4gICAgICAgIENsaWVudF9pZDogXCJaVkxLVEtTR1VMRkVRM1hNV1dJM0FMMUEyS1hZQkVLRDFMS1NVUlVaREdaWTQxSlhcIixcbiAgICAgICAgQ2xpZW50X3NlY3JldDogXCJUTVQyMDNESFdPUFIzUjRSU00xSEU0Uk1PS0VXTEdUVDBGTE1aTVVaMU9KSE1BSzFcIlxuICAgIH0sXG4gICAgeWVscDoge1xuICAgICAgICBDb25zdW1lcl9LZXk6ICAgIFwiWHJ4Sk9VZ0dOS3E5WnVXaEJYMUxEd1wiLFxuICAgICAgICBDb25zdW1lcl9TZWNyZXQ6IFwienIySTc2blQ4bDBPLXRya3VwWUUwMEI5QlRBXCIsXG4gICAgICAgIFRva2VuOiAgIFwiLV9GOGFPeG9uUjZxNVNxdlVSd3dnTElkVS1xdGVTLUJcIixcbiAgICAgICAgVG9rZW5fU2VjcmV0OiAgICBcIkdGN3VSY1BXQ3B6bEhjUlAzRGlKV2p2Y1hKRVwiXG4gICAgfVxufTtcblxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
